<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Visual Timeline of audits</title>
	<link rel="stylesheet" href="base.css">
</head>
<body>
<script type="module">
	import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";

	const worklogDataRaw = await d3.tsv("../01_status_burndown/data.txt")
	const auditDataRaw = await d3.tsv("../02_audit_duedates/audits.txt")
	const stepsRaw = await d3.tsv("../01_status_burndown/steps.tsv")
	const steps = d3.index(stepsRaw.map(d => {
		return { ...d, id: Number(d.id), stageId: Number(d.stageId), Punkte: parseFloat(d.Punkte) }
	}), d => d.stepName)

	// which timeframe should be shown
	const timeFrameShown = [new Date(2023,10,1), new Date(2024, 1, 5)]

	// preprocess the loaded data
	const auditFactData = auditDataRaw.map(d => {
			const [day, month, year] = d.dueDateAudit.split(" ")[0].split(".")
			return {
				auditId: d.auditId,
				progress: steps.get(d.progressLabel),
				dueDate: new Date(year, month-1, day)
			}
		})


	// Declare the chart dimensions and margins.
	const width = document.documentElement.clientWidth;
	const height = document.documentElement.clientHeight;
	const marginTop = 20;
	const marginRight = 40;
	const marginBottom = 50;
	const marginLeft = 40;

	// Create the SVG container.
	const svg = d3.select("body").append("svg")
			.attr("width", width)
			.attr("height", height)
			.attr("viewBox", `0, 0, ${width}, ${height}`)
			.attr("preserveAspectRatio", "none")

	// Declare the x (horizontal position) scale.
	const x = d3.scaleUtc()
			.domain([new Date("2023-01-01"), new Date("2024-01-01")])
			.range([marginLeft, width - marginRight]);

	// Declare the y (vertical position) scale.
	const y = d3.scaleBand()
			.domain([0, 100])
			.range([height - marginBottom, marginTop]);

	// Add the x-axis.
	svg.append("g")
			.attr("transform", `translate(0,${height - marginBottom})`)
			.call(d3.axisBottom(x));

	// Add the y-axis.
	svg.append("g")
			.attr("transform", `translate(${marginLeft},0)`)
			.call(d3.axisLeft(y));
</script>
</body>
</html>
